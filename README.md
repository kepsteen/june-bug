# TanStack Start + Convex + Better Auth Starter

A full-stack TypeScript application using TanStack Start, Convex, and Better Auth for modern web development with real-time data and authentication.

## Features

- **TanStack Start** - Full-stack React framework with file-based routing and SSR
- **Convex** - Real-time backend with type-safe queries and mutations
- **Better Auth** - Comprehensive authentication with multiple providers
- **TanStack Query** - Powerful data fetching and caching
- **Tailwind CSS** - Utility-first CSS framework
- **TypeScript** - End-to-end type safety

## Getting Started

### 1. Install Dependencies

```bash
npm install
```

### 2. Set Up Convex

Initialize your Convex deployment:

```bash
npx convex dev
```

This will:

- Create a new Convex project (or link to an existing one)
- Generate your `CONVEX_DEPLOYMENT` and `CONVEX_URL` values
- Start the Convex development server
- Generate TypeScript types in `convex/_generated/`

### 3. Configure Environment Variables

After running `npx convex dev`, you'll receive your Convex URLs. Update `.env.local`:

```bash
# Copy the values from your Convex dashboard
VITE_CONVEX_URL=https://your-deployment.convex.cloud
CONVEX_DEPLOYMENT=dev:your-deployment
CONVEX_SITE_URL=https://your-deployment.convex.site
VITE_CONVEX_SITE_URL=https://your-deployment.convex.site
```

### 4. Run the Development Server

In a separate terminal (keep `npx convex dev` running):

```bash
npm run dev
```

Or run both together with concurrently:

```bash
npm run dev
# This runs both: npm run dev:web (Vite) and npm run dev:db (Convex)
```

Open [http://localhost:3000](http://localhost:3000) to see your app.

## Project Structure

```
my-tanstack-convex-app/
├── src/
│   ├── routes/              # TanStack Router routes
│   │   ├── __root.tsx       # Root layout with auth context
│   │   ├── _authed/         # Protected routes (require login)
│   │   ├── api/auth/$.ts    # Better Auth API handler
│   │   └── ...
│   ├── components/          # React components
│   │   └── ui/              # shadcn/ui components
│   ├── lib/
│   │   ├── auth-client.ts   # Better Auth client config
│   │   └── auth-server.ts   # Server-side auth utilities
│   └── router.tsx           # Router configuration
├── convex/
│   ├── auth.ts              # Better Auth backend config
│   ├── http.ts              # HTTP routes (auth endpoints)
│   ├── schema.ts            # Database schema
│   ├── betterAuth/          # Better Auth component
│   └── ...                  # Your queries, mutations, actions
├── public/                  # Static assets
└── vite.config.ts           # Vite + TanStack Start config
```

## Authentication

This starter includes Better Auth with the Convex adapter. By default, it supports:

- **Email/Password** - Standard username/password authentication
- **Magic Links** - Passwordless email authentication
- **Email OTP** - One-time password codes
- **OAuth** - Google, GitHub, and other providers (configure in `.env.local`)
- **Two-Factor Auth** - TOTP-based 2FA
- **Passkeys** - WebAuthn/FIDO2 support

### Adding OAuth Providers

1. Get OAuth credentials from provider (Google, GitHub, etc.)
2. Add to `.env.local`:
   ```bash
   GOOGLE_CLIENT_ID=your_client_id
   GOOGLE_CLIENT_SECRET=your_client_secret
   ```
3. Update `convex/auth.ts` to enable the provider
4. Configure redirect URLs in provider dashboard

## Database Schema

The Convex schema is defined in `convex/schema.ts`. Better Auth tables are automatically generated by the adapter.

### Adding Tables

1. Define your table in `convex/schema.ts`:

   ```typescript
   export default defineSchema({
     todos: defineTable({
       text: v.string(),
       isCompleted: v.boolean(),
       userId: v.id('users'),
     }).index('by_user', ['userId']),
   })
   ```

2. TypeScript types are automatically generated in `convex/_generated/dataModel.d.ts`

## Writing Convex Functions

Create queries, mutations, and actions in the `convex/` directory:

```typescript
// convex/todos.ts
import { query, mutation } from './_generated/server'
import { v } from 'convex/values'

export const list = query({
  args: {},
  returns: v.array(
    v.object({
      _id: v.id('todos'),
      text: v.string(),
      isCompleted: v.boolean(),
    }),
  ),
  handler: async (ctx) => {
    const identity = await ctx.auth.getUserIdentity()
    if (!identity) return []

    return await ctx.db
      .query('todos')
      .withIndex('by_user', (q) => q.eq('userId', identity.subject))
      .collect()
  },
})
```

### Server-Side Data Fetching (SSR)

Use `fetchQuery`, `fetchMutation`, or `fetchAction` in route loaders:

```typescript
// src/routes/todos.tsx
import { createFileRoute } from '@tanstack/react-router'
import { fetchQuery } from '@/lib/auth-server'
import { api } from '../../convex/_generated/api'

export const Route = createFileRoute('/todos')({
  loader: async () => {
    const todos = await fetchQuery(api.todos.list)
    return { todos }
  },
})
```

## Protected Routes

Routes under `_authed/` require authentication. The layout redirects unauthenticated users to `/sign-in`.

```typescript
// src/routes/_authed.tsx
export const Route = createFileRoute('/_authed')({
  beforeLoad: ({ context }) => {
    if (!context.userId) {
      throw redirect({ to: '/sign-in' })
    }
  },
})
```

## Scripts

- `npm run dev` - Start both Vite dev server and Convex (concurrent)
- `npm run dev:web` - Start Vite dev server only (port 3000)
- `npm run dev:db` - Start Convex dev server only
- `npm run build` - Build for production
- `npm run start` - Start production server
- `npm run lint` - Check code style with Prettier and ESLint
- `npm run format` - Auto-format code with Prettier
- `npm run generate` - Generate Convex schema once (useful for CI)

## Deployment

### Deploy Convex Backend

```bash
# Deploy to production
npx convex deploy

# Get your production URL and update env vars
```

### Deploy Frontend

This app can be deployed to any platform that supports Node.js:

- **Vercel** - `vercel deploy`
- **Netlify** - `netlify deploy`
- **Railway** - Connect GitHub repo
- **Render** - Connect GitHub repo

Make sure to set environment variables in your deployment platform:

- `VITE_CONVEX_URL`
- `VITE_CONVEX_SITE_URL`
- `CONVEX_SITE_URL`

## Learn More

- [TanStack Start Docs](https://tanstack.com/router/latest/docs/framework/react/start)
- [Convex Docs](https://docs.convex.dev)
- [Better Auth Docs](https://better-auth.com)
- [Convex + Better Auth Integration](https://convex-better-auth.netlify.app)

## License

MIT
